<div class="navbar-area" [ngClass]="{'is-sticky': isSticky}">
  <div class="container-fluid">
    <nav class="navbar navbar-expand-lg navbar-light">
      <a class="navbar-brand" routerLink="/">
        <img src="images/logo.png" alt="logo">
      </a>
      <button class="navbar-toggler rounded-0 shadow-none" (click)="toggleClass()" type="button">
        <span class="burger-menu">
          <span class="top-bar"></span>
          <span class="middle-bar"></span>
          <span class="bottom-bar"></span>
        </span>
      </button>
      <div class="collapse navbar-collapse mean-menu">
        <ul class="navbar-nav mx-4">
          <li class="nav-item">
            <a routerLink="/home" class="nav-link">
              الرئيسيه <i class='bx bx-chevron-down'></i>
            </a>
          </li>
          <li class="nav-item">
            <a routerLink="/programs" class="nav-link">
              البرامج <i class='bx bx-chevron-down'></i>
            </a>
          </li>
          <li class="nav-item" *ngIf="isAdmin">
            <a routerLink="/users" class="nav-link">
              المستخدمين <i class='bx bx-chevron-down'></i>
            </a>
          </li>
          <li class="nav-item">
            <a *ngIf="isCoach || isMentor" routerLink="/my-programs" class="nav-link">
              حقائبى التدريبيه <i class='bx bx-chevron-down'></i>
            </a>
          </li>
          <li class="nav-item">
            <a *ngIf="isLoggedIn && !isCoach && !isAdmin" routerLink="/subscriptions" class="nav-link">
              اشتراكاتى <i class='bx bx-chevron-down'></i>
            </a>
          </li>
        </ul>
        <div class="others-option d-flex align-items-center">
          <div class="option-item">
            <form class="search-box" (ngSubmit)="search()">
              <input type="text" class="input-search" placeholder="ابحث عن تدريب..." [(ngModel)]="searchText"
                name="search" />
              <button type="submit">
                <i class="flaticon-loupe"></i>
              </button>
            </form>
          </div>

          <!-- Notifications Dropdown -->
          <div *ngIf="isLoggedIn === true" class="option-item position-relative">
            <div class="notification-wrapper">
              <button class="notification-btn" (click)="toggleNotifications()" type="button"
                [class.active]="showNotifications">
                <i class="bx bx-bell"></i>
                <span *ngIf="unreadCount() > 0" class="notification-badge">{{ unreadCount() }}</span>
              </button>

              <!-- Notifications Dropdown -->
              <div class="notifications-dropdown" [class.show]="showNotifications" *ngIf="showNotifications">
                <!-- <div class="notifications-header">
                  <h6>الإشعارات</h6>
                  <button class="mark-all-read" (click)="markAllAsRead()" *ngIf="notifications.length > 0">
                    تعيين الكل كمقروء
                  </button>
                </div> -->

                <div class="notifications-body">
                  <div *ngIf="loadingNotifications" class="loading-state">
                    <i class="bx bx-loader-alt bx-spin"></i>
                    جاري التحميل...
                  </div>

                  <div *ngIf="!loadingNotifications && notifications.length === 0" class="empty-state">
                    <i class="bx bx-bell-off"></i>
                    لا توجد إشعارات جديدة
                  </div>

                  <ng-container *ngFor="let notification of notifications">
                    <!-- External Link -->
                    <a *ngIf="notification.type === 3; else internalLink" [href]="notification.url" target="_blank"
                      rel="noopener" [ngClass]="{ 'notification-item': true, 'unread': !notification.isRead }"
                      (click)="handleNotificationClick(notification)">
                      <div class="notification-content">
                        <div class="notification-title">{{ notification.content }}</div>
                        <div class="notification-time">{{ notification.creationDate | date: 'short' }}</div>
                      </div>
                      <div class="notification-status" *ngIf="!notification.isRead">
                        <span class="unread-dot"></span>
                      </div>
                    </a>

                    <!-- Internal Link -->
                    <ng-template #internalLink>
                      <a [routerLink]="notification.url"
                        [ngClass]="{ 'notification-item': true, 'unread': !notification.isRead }"
                        (click)="handleNotificationClick(notification)">
                        <div class="notification-content">
                          <div class="notification-title">{{ notification.content }}</div>
                          <div class="notification-time">{{ notification.creationDate | date: 'short' }}</div>
                        </div>
                        <div class="notification-status" *ngIf="!notification.isRead">
                          <span class="unread-dot"></span>
                        </div>
                      </a>
                    </ng-template>
                  </ng-container>
                </div>

                <!-- <div class="notifications-footer" *ngIf="notifications.length > 0">
                  <a routerLink="/notifications" (click)="closeNotifications()">
                    عرض جميع الإشعارات
                  </a>
                </div> -->
              </div>
            </div>
          </div>

          <!-- User Welcome Message -->
          <div *ngIf="isLoggedIn === true" class="option-item">
            <div class="fw-bold fs-5 text-primary mt-1">
              <span class="text-muted">أهلاً بك،</span>
              {{ currentUser?.userName }}
            </div>
          </div>

          <!-- Profile Dropdown / Login Button -->
          <div class="option-item" style="cursor: pointer;">
            <!-- Loading State -->
            <div *ngIf="isLoggedIn === null" class="default-btn loading-btn">
              <i class="bx bx-loader-alt bx-spin"></i>
              جاري التحميل...
              <span></span>
            </div>

            <!-- Login Button -->
             
            <a *ngIf="isLoggedIn == false" routerLink="/login" class="default-btn">
              <i class="flaticon-left"></i>
              الدخول
              <span></span>
            </a>

            <!-- Profile Dropdown -->
            <div *ngIf="isLoggedIn === true" class="profile-dropdown-wrapper position-relative">
              <button class="profile-btn" (click)="toggleProfileDropdown()" type="button"
                [class.active]="showProfileDropdown">
                <i class="bx bx-user-circle"></i>
              </button>

              <!-- Profile Dropdown Menu -->
              <div class="profile-dropdown" [class.show]="showProfileDropdown" *ngIf="showProfileDropdown">
                <div class="profile-dropdown-header">
                  <div class="user-info">
                    <div class="user-avatar">
                      <i class="bx bx-user-circle"></i>
                    </div>
                    <div class="user-details">
                      <div class="user-name">{{ currentUser?.userName }}</div>
                      <div class="user-email" *ngIf="currentUser?.email">{{ currentUser?.email }}</div>
                    </div>
                  </div>
                </div>

                <div class="profile-dropdown-body">
                  <a *ngIf="!isAdmin && !isCoach" [routerLink]="['/profile',currentUser?.id]" class="dropdown-item" (click)="closeProfileDropdown()">
                    <i class="bx bx-user me-2"></i>
                    الملف الشخصي
                  </a>

                  <div class="dropdown-divider"></div>
                  <button class="dropdown-item logout-item" (click)="logout()" [disabled]="isLoggingOut">
                    <i class="bx bx-log-out me-2" *ngIf="!isLoggingOut"></i>
                    <i class="bx bx-loader-alt bx-spin me-2" *ngIf="isLoggingOut"></i>
                    {{ isLoggingOut ? 'جاري الخروج...' : 'تسجيل الخروج' }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>
  </div>
</div>

<!-- Responsive Navbar -->
<div class="responsive-navbar offcanvas offcanvas-end border-0 transition" [class.show]="classApplied">
  <div class="offcanvas-header d-flex justify-content-between align-items-center">
    <a routerLink="/" class="logo d-inline-block">
      <img src="images/logo.png" alt="logo" />
    </a>
    <button type="button" (click)="toggleClass()" class="close-btn bg-transparent position-relative p-0 border-0">
      <i class="bx bx-x fs-2"></i>
    </button>
  </div>

  <div class="offcanvas-body">
    <ul class="list-unstyled p-0 m-0">
      <li>
        <a   routerLink="/home" class="d-block py-2 fw-bold">الرئيسيه</a>
      </li>
      <li>
        <a routerLink="/programs" class="d-block py-2 fw-bold">البرامج</a>
      </li>
<!--       
      <div *ngIf="isMentor == true" style="background-color: red; width: 100px;height: 100px;">

      </div> -->
      <li *ngIf="isCoach " >
        <a routerLink="/my-programs" class="d-block py-2 fw-bold">حقائبى التدريبيه</a>
      </li>
      <li *ngIf="isAdmin && isLoggedIn">
        <a routerLink="/users" class="d-block py-2 fw-bold">اداره المستخدمين</a>
      </li>
      <li *ngIf="isLoggedIn === true && !isCoach && !isAdmin">
        <a routerLink="/subscriptions" class="d-block py-2 fw-bold">اشتراكاتى</a>
      </li>
    </ul>

    <div class="my-3">
      <form class="search-box" (ngSubmit)="search()">
        <input type="text" class="form-control mb-2" placeholder="ابحث عن تدريب..." [(ngModel)]="searchText"
          name="search" />
        <button type="submit" class="btn btn-primary w-100">
          <i class="flaticon-loupe me-1"></i> ابحث
        </button>
      </form>
    </div>

    <div class="mt-4">
      <!-- Loading State -->
      <div *ngIf="isLoggedIn === null" class="btn btn-outline-secondary w-100 mb-2 disabled-btn">
        <i class="bx bx-loader-alt bx-spin me-1"></i> جاري التحميل...
      </div>

      <!-- Login Button -->
       
      <a *ngIf="isLoggedIn == false" routerLink="/login" class="btn btn-outline-primary w-100 mb-2">
        <i class="flaticon-left me-1"></i> الدخول
      </a>
      <!-- Profile Options for Mobile -->
      <div *ngIf="isLoggedIn === true" class="mobile-profile-section">
        <a [routerLink]="['/profile', currentUser?.id]" class="btn btn-outline-primary w-100 mb-2">
          <i class="bx bx-user me-1"></i> الملف الشخصي
        </a>
        <button (click)="logout()" class="btn btn-danger w-100" [disabled]="isLoggingOut">
          <i class="bx bx-log-out me-1" *ngIf="!isLoggingOut"></i>
          <i class="bx bx-loader-alt bx-spin me-1" *ngIf="isLoggingOut"></i>
          {{ isLoggingOut ? 'جاري الخروج...' : 'تسجيل الخروج' }}
        </button>
      </div>
    </div>
  </div>
</div>

<div class="offcanvas-backdrop fade" [class.show]="classApplied"></div>