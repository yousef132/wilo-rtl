<div class="ai-exam-container" style="margin-top: 100px;">
  <!-- AI Header -->
  <div class="ai-header">
    <div class="ai-avatar">
      <div class="ai-brain">
        <div class="brain-pulse" [class.thinking]="isThinking"></div>
        <i class='bx bx-bot'></i>
      </div>
    </div>
    <h1 class="ai-title">ุงููุณุงุนุฏ ุงูุฐูู ููุชุนูู</h1>
    <div class="progress-indicator" *ngIf="examState !== 'loading' && examState !== 'final-results' && examState !== 'generating-certificate' && examState !== 'course-completed' && examState !== 'exam-failed'">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="progressPercentage"></div>
      </div>
      <span class="progress-text">ุงูุณุคุงู {{ currentQuestionIndex + 1 }} ูู {{ totalQuestions }}</span>
    </div>
  </div>

  <!-- Loading Phase -->
  <div *ngIf="examState === 'loading'" class="loading-phase">
    <div class="ai-card">
      <div class="ai-thinking">
        <div class="thinking-dots">
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
        </div>
        <h2>๐ง ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุญุถูุฑ ุงุฎุชุจุงุฑู...</h2>
        <p>ูุชู ุชุญููู ุงููุญุชูู ูุฅูุดุงุก ุฃุณุฆูุฉ ูุฎุตุตุฉ ูู</p>
        <div class="loading-bar">
          <div class="loading-progress"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Question Phase -->
  <div *ngIf="examState === 'question'" class="question-phase">
    <div class="ai-card">
      <div class="ai-message-bubble">
        <div class="ai-avatar-small"><i class='bx bx-bot'></i></div>
        <div class="message-content">
          <div class="ai-badge">ูููุฏ ุงูุฃุณุฆูุฉ ุงูุฐูู</div>
          <h3 class="question-title">ุงูุณุคุงู {{ currentQuestionIndex + 1 }}</h3>
          <p class="question-text">{{ currentQuestion }}</p>
        </div>
      </div>

      <div class="user-response-area">
        <div class="response-header">
          <span class="user-avatar">๐ค</span>
          <span class="response-label">ุฅุฌุงุจุชู</span>
        </div>
        <textarea
          [(ngModel)]="currentAnswer"
          placeholder="ุงูุชุจ ุฅุฌุงุจุชู ููุง... ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูู ุงูุชุธุงุฑ ุฑุฏู."
          class="ai-answer-input"
          rows="4"
          [disabled]="isLoading">
        </textarea>
        <button
          (click)="submitAnswer()"
          [disabled]="!currentAnswer.trim() || isLoading"
          class="ai-submit-btn">
          <span *ngIf="!isLoading">๐ ุฅุฑุณุงู ููุฐูุงุก ุงูุงุตุทูุงุนู</span>
          <span *ngIf="isLoading" class="loading-text">
            <span class="thinking-dots-inline">
              <span class="dot-inline"></span>
              <span class="dot-inline"></span>
              <span class="dot-inline"></span>
            </span>
            ูุชู ุชุญููู ุฅุฌุงุจุชู...
          </span>
        </button>
      </div>
    </div>
  </div>

  <!-- Feedback Phase -->
  <div *ngIf="examState === 'feedback'" class="feedback-phase">
    <div class="ai-card">
      <div class="ai-feedback-header">
        <div class="ai-avatar-feedback">
          <div class="feedback-pulse"></div>
          ๐ฏ
        </div>
        <div class="feedback-score">
          <div class="score-circle" [class]="getScoreClass(lastEvaluation?.score || 0)">
            <span class="score-number">{{ lastEvaluation?.score || 0 }}</span>
            <span class="score-label">ุงููุชูุฌุฉ</span>
          </div>
        </div>
      </div>

      <div class="ai-feedback-bubble">
        <div class="ai-avatar-small"><i class='bx bx-bot'></i></div>
        <div class="feedback-content">
          <div class="ai-badge">ูุญุฑู ุงูุชุบุฐูุฉ ุงูุฑุงุฌุนุฉ</div>
          <p class="feedback-text">{{ lastEvaluation?.feedback }}</p>
        </div>
      </div>

      <div class="answer-review-section">
        <div class="review-header">
          <span class="review-icon">๐</span>
          <span>ูุฑุงุฌุนุฉ ุฅุฌุงุจุชู</span>
        </div>
        <div class="your-answer-display">{{ studentAnswers[currentQuestionIndex]?.answer }}</div>
      </div>

      <div class="next-question-area">
        <div *ngIf="isWaitingForNext" class="ai-generating">
          <div class="thinking-dots">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
          </div>
          <p>ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุญุถูุฑ ุงูุณุคุงู ุงูุชุงูู...</p>
        </div>
        <button
          *ngIf="!isWaitingForNext"
          (click)="proceedToNext()"
          class="ai-next-btn">
          <span *ngIf="hasMoreQuestions()">โก ุฌุงูุฒ ููุณุคุงู ุงูุชุงูู</span>
          <span *ngIf="!hasMoreQuestions()">๐ ุนุฑุถ ุงูุชูููู ุงูููุงุฆู</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Certificate Generation Phase -->
  <div *ngIf="examState === 'generating-certificate'" class="certificate-generation-phase">
    <div class="ai-card">
      <div class="certificate-header">
        <div class="certificate-icon">๐</div>
        <h2>ุชูุงูููุง! ููุฏ ุฃูููุช ุงูุฏูุฑุฉ ุจูุฌุงุญ</h2>
        <div class="final-score-display" [class]="getFinalScoreClass()">
          <div class="final-score-number">{{ finalEvaluation?.finalScore || 0 }}</div>
          <div class="final-score-suffix">/100</div>
        </div>
      </div>

      <div class="certificate-generation">
        <div class="certificate-animation">
          <div class="certificate-generating-icon">๐</div>
          <div class="generation-pulse"></div>
        </div>
        <h3>ุฌุงุฑู ุฅูุดุงุก ุดูุงุฏุฉ ุงูุฅุชูุงู...</h3>
        <p>ูุชู ุฅูุชุงุฌ ุดูุงุฏุชู ุงูุฑุณููุฉ ูุฑูุนูุง ุฅูู ุงููุธุงู</p>
        <div class="certificate-loading-bar">
          <div class="certificate-progress"></div>
        </div>
        <div class="generation-steps">
          <div class="step active">โ ุชูููู ุงูุฃุฏุงุก</div>
          <div class="step active">โ ุฅูุดุงุก ุงูุดูุงุฏุฉ</div>
          <div class="step" [class.active]="certificateGenerating">โณ ุฑูุน ุงูุดูุงุฏุฉ</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Course Completed Phase -->
  <div *ngIf="examState === 'course-completed'" class="course-completed-phase">
    <div class="ai-card">
      <div class="completion-celebration">
        <div class="celebration-icons">
          <div class="celebration-icon">๐</div>
          <div class="celebration-icon">๐</div>
          <div class="celebration-icon">๐</div>
        </div>
        <h2>ูุจุฑูู! ุชู ุฅููุงู ุงูุฏูุฑุฉ ุจูุฌุงุญ</h2>
        <div class="course-name">{{ programName }}</div>
        <div class="final-score-display excellent">
          <div class="final-score-number">{{ finalEvaluation?.finalScore || 0 }}</div>
          <div class="final-score-suffix">/100</div>
        </div>
      </div>

      <div class="completion-message">
        <div class="ai-avatar-small">
          <i class='bx bx-bot'></i>

        </div>
        <div class="message-content">
          <div class="ai-badge">ุชูุงูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู</div>
          <p>{{ finalEvaluation?.feedback }}</p>
          <div class="certificate-ready">
            <span class="certificate-icon">๐</span>
            <span>ุชู ุฅูุดุงุก ุดูุงุฏุฉ ุงูุฅุชูุงู ุจูุฌุงุญ ูุญูุธูุง ูู ุญุณุงุจู</span>
          </div>
        </div>
      </div>

      <div class="completion-actions">
        <button (click)="goToCourses()" class="primary-btn">
          ๐ ุนุฑุถ ุงูุฏูุฑุงุช ุงูุฃุฎุฑู
        </button>
        <!-- <button (click)="restartExam()" class="secondary-btn">
          ๐ ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ
        </button> -->
      </div>
    </div>
  </div>

  <!-- Exam Failed Phase -->
  <div *ngIf="examState === 'exam-failed'" class="exam-failed-phase">
    <div class="ai-card">
      <div class="failure-header">
        <div class="failure-icon">๐</div>
        <h2>ูู ุชุฌุชุฒ ุงูุงูุชุญุงู ูุฐู ุงููุฑุฉ</h2>
        <div class="final-score-display poor">
          <div class="final-score-number">{{ finalEvaluation?.finalScore || 0 }}</div>
          <div class="final-score-suffix">/100</div>
        </div>
        <p class="passing-message">ุชุญุชุงุฌ ุฅูู ูุชูุฌุฉ ุฃุนูู ูููุฌุงุญ ูู ูุฐุง ุงูุงูุชุญุงู</p>
      </div>

      <div class="failure-feedback">
        <div class="ai-avatar-small"><i class='bx bx-bot'></i></div>
        <div class="feedback-content">
          <div class="ai-badge">ุชุญููู ุงูุฃุฏุงุก</div>
          <p>{{ finalEvaluation?.feedback }}</p>
        </div>
      </div>

      <div class="failure-actions">
        <button (click)="restartExam()" class="retry-btn">
          ๐ ุฅุนุงุฏุฉ ุงููุญุงููุฉ
        </button>
        <button (click)="goToCourses()" class="back-btn">
          โ ุงูุนูุฏุฉ ููุฏุฑุณ
        </button>
      </div>
    </div>
  </div>

  <!-- Final Results Phase (for passed but not completed course) -->
  <div *ngIf="examState === 'final-results'" class="final-results-phase">
    <div class="ai-card">
      <div class="final-assessment-header">
        <div class="ai-trophy">๐</div>
        <h2>ุฃุญุณูุช! ููุฏ ุงุฌุชุฒุช ุงูุงูุชุญุงู</h2>
        <div class="final-score-display" [class]="getFinalScoreClass()">
          <div class="final-score-number">{{ finalEvaluation?.finalScore || 0 }}</div>
          <div class="final-score-suffix">/100</div>
        </div>
      </div>

      <div class="ai-summary-bubble">
        <div class="ai-avatar-small"><i class='bx bx-bot'></i></div>
        <div class="summary-content">
          <div class="ai-badge">ุชุญููู ุงูุฃุฏุงุก</div>
          <p class="summary-text">{{ finalEvaluation?.feedback }}</p>
        </div>
      </div>

      <div class="next-content-notification">
        <h3>ุฌุงูุฒ ูููุญุชูู ุงูุชุงููุ</h3>
        <p style="color: white;">ุชู ูุชุญ ุงููุญุชูู ุงูุชุงูู ูู ุงูุฏูุฑุฉ</p>
      </div>

      <div class="detailed-review">
        <h4 class="review-section-title">๐ ูุฑุงุฌุนุฉ ุชูุตูููุฉ ููุฅุฌุงุจุงุช</h4>
        <div *ngFor="let answer of studentAnswers; let i = index" class="detailed-answer-item">
          <div class="question-number-badge">ุณ{{ i + 1 }}</div>
          <div class="question-content">
            <div class="original-question">{{ questions[i] }}</div>
            <div class="student-response">
              <span class="response-icon">๐ค</span>
              <span class="response-text">{{ answer.answer }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="final-actions">
        <button (click)="goToNextContent()" class="next-content-btn">
          โก๏ธ ุงูุงูุชูุงู ูููุญุชูู ุงูุชุงูู
        </button>
        <!-- <button (click)="restartExam()" class="secondary-btn">
          ๐ ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ
        </button> -->
      </div>
    </div>
  </div>

  <!-- Error Toast -->
  <div *ngIf="errorMessage" class="error-toast">
    <span class="error-icon">โ๏ธ</span>
    <span class="error-text">{{ errorMessage }}</span>
    <button (click)="errorMessage = ''" class="error-dismiss">โ</button>
  </div>
</div>